{% extends 'main/layout.html' %}

{% block content %}
<main id="main" class="relative min-h-screen py-10">
    <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ–Ω -->
    <div aria-hidden="true"
        class="pointer-events-none absolute inset-x-0 -top-20 -z-10 h-64 bg-gradient-to-b from-primary/10 to-transparent blur-2xl">
    </div>

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header —Å —Ç–∞–π–º–µ—Ä–æ–º –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4 flex-wrap gap-4">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-900 tracking-tight m-0">
                        –¢–µ—Å—Ç –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                    </h1>
                    <p class="text-sm text-gray-600 mt-1 m-0">
                        –û—Ç–≤–µ—á–∞–π—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ, –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –≤–æ–ø—Ä–æ—Å–∞–º –Ω–µ–ª—å–∑—è
                    </p>
                </div>

                <!-- –¢–∞–π–º–µ—Ä -->
                <div class="flex items-center gap-3 px-5 py-3 rounded-xl bg-white ring-1 ring-gray-200 shadow-sm">
                    <i class="fas fa-clock text-primary text-xl" aria-hidden="true"></i>
                    <div>
                        <div class="text-xs text-gray-500 font-medium">–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏</div>
                        <div id="timer" class="text-2xl font-bold text-gray-900" data-time="{{ time_remaining }}">
                            {{ time_remaining_formatted }} <!-- üëà –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
            <div class="relative">
                <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                    <div id="progressBar"
                        class="h-full bg-gradient-to-r from-primary to-emerald-700 transition-all duration-500 ease-out"
                        style="width: {{ progress_percentage }}%">
                    </div>
                </div>
                <div class="flex items-center justify-between mt-2">
                    <span class="text-sm font-medium text-gray-600">
                        –í–æ–ø—Ä–æ—Å {{ current_question }} –∏–∑ {{ total_questions }}
                    </span>
                    <span class="text-sm font-medium text-primary">
                        {{ progress_percentage }}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                    </span>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –≤—Ä–µ–º–µ–Ω–∏ -->
        {% if time_warning == 'critical' %}
        <div class="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-lg animate-pulse">
            <div class="flex items-center gap-3">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl" aria-hidden="true"></i>
                <div>
                    <h4 class="font-bold text-red-900 m-0">–í–Ω–∏–º–∞–Ω–∏–µ! –û—Å—Ç–∞–ª–∞—Å—å 1 –º–∏–Ω—É—Ç–∞</h4>
                    <p class="text-sm text-red-800 mt-1 m-0">–ü–æ—Ç–æ—Ä–æ–ø–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</p>
                </div>
            </div>
        </div>
        {% elif time_warning == 'low' %}
        <div class="mb-6 p-4 bg-amber-50 border-l-4 border-amber-500 rounded-lg">
            <div class="flex items-center gap-3">
                <i class="fas fa-clock text-amber-600 text-xl" aria-hidden="true"></i>
                <div>
                    <h4 class="font-bold text-amber-900 m-0">–û—Å—Ç–∞–ª–æ—Å—å 5 –º–∏–Ω—É—Ç</h4>
                    <p class="text-sm text-amber-800 mt-1 m-0">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Å–∫–æ—Ä–∏—Ç—å—Å—è</p>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- –§–æ—Ä–º–∞ —Å –≤–æ–ø—Ä–æ—Å–æ–º -->
        <form id="testForm" method="POST" action="{% url 'user_test:question' %}">
            {% csrf_token %}
            <input type="hidden" name="question_number" value="{{ current_question }}">
            <input type="hidden" name="question_id" value="{{ question.id }}">

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ -->
            <div
                class="bg-white rounded-2xl ring-1 ring-gray-200 shadow-sm overflow-hidden transition-all duration-300 animate-[fadeIn_0.3s_ease-out]">
                <div class="px-6 py-5 border-b border-gray-100 bg-gray-50/60">
                    <div class="flex items-start justify-between gap-4">
                        <h3 class="text-lg font-bold text-gray-900 m-0">
                            <span
                                class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary text-sm font-bold mr-3">
                                {{ current_question }}
                            </span>
                            {{ question.question_text }}
                        </h3>
                        <span
                            class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-semibold 
              {% if question.question_type == 'single' %}bg-blue-100 text-blue-700{% elif question.question_type == 'multiple' %}bg-purple-100 text-purple-700{% else %}bg-amber-100 text-amber-700{% endif %}">
                            <i class="fas {% if question.question_type == 'single' %}fa-check-circle{% elif question.question_type == 'multiple' %}fa-check-double{% else %}fa-keyboard{% endif %}"
                                aria-hidden="true"></i>
                            {% if question.question_type == 'single' %}
                            –û–¥–∏–Ω –æ—Ç–≤–µ—Ç
                            {% elif question.question_type == 'multiple' %}
                            –ù–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç–æ–≤
                            {% else %}
                            –°–≤–æ–±–æ–¥–Ω—ã–π –æ—Ç–≤–µ—Ç
                            {% endif %}
                        </span>
                    </div>
                </div>

                <div class="p-6">
                    <!-- –û–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã–±–æ—Ä (radio) -->
                    {% if question.question_type == 'single' %}
                    <div class="space-y-3">
                        {% for option in question.options %}
                        <label
                            class="flex items-center p-4 rounded-xl border-2 border-gray-200 cursor-pointer transition-all hover:border-primary hover:bg-primary/5 has-[:checked]:border-primary has-[:checked]:bg-primary/5 has-[:checked]:ring-2 has-[:checked]:ring-primary/20">
                            <input type="radio" name="answer" value="{{ forloop.counter0 }}"
                                class="w-5 h-5 text-primary focus:ring-2 focus:ring-primary" required>
                            <span class="ml-3 text-base font-medium text-gray-900">{{ option }}</span>
                        </label>
                        {% endfor %}
                    </div>

                    <!-- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä (checkbox) -->
                    {% elif question.question_type == 'multiple' %}
                    <div class="space-y-3">
                        {% for option in question.options %}
                        <label
                            class="flex items-center p-4 rounded-xl border-2 border-gray-200 cursor-pointer transition-all hover:border-primary hover:bg-primary/5 has-[:checked]:border-primary has-[:checked]:bg-primary/5 has-[:checked]:ring-2 has-[:checked]:ring-primary/20">
                            <input type="checkbox" name="answer" value="{{ forloop.counter0 }}"
                                class="w-5 h-5 text-primary rounded focus:ring-2 focus:ring-primary">
                            <span class="ml-3 text-base font-medium text-gray-900">{{ option }}</span>
                        </label>
                        {% endfor %}
                    </div>
                    <p class="mt-3 text-sm text-gray-500">
                        <i class="fas fa-info-circle mr-1" aria-hidden="true"></i>
                        –í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                    </p>

                    <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ -->
                    {% elif question.question_type == 'text' %}
                    <input type="text" name="answer" id="textAnswer"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl text-base transition-all focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 placeholder:text-gray-400"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç –∑–¥–µ—Å—å..." required autocomplete="off">
                    <p class="mt-3 text-sm text-gray-500">
                        <i class="fas fa-info-circle mr-1" aria-hidden="true"></i>
                        –í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º –∏–ª–∏ —Ñ—Ä–∞–∑–æ–π
                    </p>
                    {% endif %}
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
            <div
                class="mt-8 flex items-center justify-between gap-4 p-6 bg-white rounded-2xl ring-1 ring-gray-200 shadow-sm flex-wrap">
                <div class="text-center flex-1 min-w-[200px]">
                    <p class="text-sm text-gray-600 mb-1">–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ –æ—Ç–≤–µ—á–∞–π—Ç–µ —á–µ—Å—Ç–Ω–æ</p>
                    <p class="text-xs text-gray-500">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–º–æ–≥—É—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É</p>
                </div>

                <div class="flex gap-3 flex-wrap justify-center">
                    <button type="submit" name="action" value="next"
                        class="group relative inline-flex items-center gap-2 px-6 py-3 rounded-full text-sm font-semibold bg-primary text-white overflow-hidden transition-all hover:-translate-y-0.5 hover:shadow-md hover:bg-emerald-700 active:brightness-95">
                        <span class="relative z-10">–î–∞–ª–µ–µ</span>
                        <i class="fas fa-arrow-right relative z-10 transition-transform group-hover:translate-x-1"
                            aria-hidden="true"></i>
                    </button>

                    {% if can_finish %}
                    <button type="button" onclick="confirmFinish()"
                        class="inline-flex items-center gap-2 px-6 py-3 rounded-full text-sm font-semibold bg-white ring-1 ring-gray-300 text-gray-800 transition-all hover:text-primary hover:ring-primary hover:-translate-y-0.5 hover:shadow-md">
                        <i class="fas fa-flag-checkered" aria-hidden="true"></i>
                        –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ
                    </button>
                    {% else %}
                    <button type="button" disabled title="–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –º–∏–Ω–∏–º—É–º –Ω–∞ 10 –≤–æ–ø—Ä–æ—Å–æ–≤"
                        class="inline-flex items-center gap-2 px-6 py-3 rounded-full text-sm font-semibold bg-gray-100 text-gray-400 cursor-not-allowed">
                        <i class="fas fa-flag-checkered" aria-hidden="true"></i>
                        –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ
                    </button>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
</main>

<!-- Loading screen -->
<div id="loadingOverlay"
    class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 text-center max-w-md mx-4 shadow-2xl">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mb-4">
            <i class="fas fa-spinner fa-spin text-3xl text-primary" aria-hidden="true"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞...</h3>
        <p class="text-sm text-gray-600">–ò–ò –ø–æ–¥–±–∏—Ä–∞–µ—Ç –≤–æ–ø—Ä–æ—Å –ø–æ–¥ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å</p>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
<div id="finishModal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeFinishModal()"></div>
    <div class="relative flex min-h-full items-center justify-center p-4">
        <div class="w-full max-w-md overflow-hidden rounded-2xl bg-white shadow-2xl">
            <div class="p-6">
                <div class="flex items-center justify-center w-16 h-16 mx-auto mb-4 rounded-full bg-amber-100">
                    <i class="fas fa-flag-checkered text-amber-600 text-2xl" aria-hidden="true"></i>
                </div>
                <h2 class="text-xl font-bold text-center text-gray-900 mb-2">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç –¥–æ—Å—Ä–æ—á–Ω–æ?</h2>
                <p class="text-center text-gray-600 mb-6">
                    –í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ <strong>{{ current_question }} –∏–∑ {{ total_questions }}</strong> –≤–æ–ø—Ä–æ—Å–æ–≤.
                    –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—á–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.
                </p>

                <div class="flex gap-3">
                    <button type="button" onclick="closeFinishModal()"
                        class="flex-1 px-5 py-3 rounded-full text-sm font-semibold bg-white ring-1 ring-gray-300 text-gray-800 transition hover:text-primary hover:ring-primary">
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ—Å—Ç
                    </button>
                    <button type="button" onclick="finishTest()"
                        class="flex-1 px-5 py-3 rounded-full text-sm font-semibold bg-primary text-white transition hover:bg-emerald-700">
                        –î–∞, –∑–∞–≤–µ—Ä—à–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–∞–π–º–∞—É—Ç–∞ -->
<div id="timeoutModal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
    <div class="relative flex min-h-full items-center justify-center p-4">
        <div class="w-full max-w-md overflow-hidden rounded-2xl bg-white shadow-2xl">
            <div class="p-6">
                <div class="flex items-center justify-center w-16 h-16 mx-auto mb-4 rounded-full bg-red-100">
                    <i class="fas fa-clock text-red-600 text-2xl" aria-hidden="true"></i>
                </div>
                <h2 class="text-xl font-bold text-center text-gray-900 mb-2">–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ!</h2>
                <p class="text-center text-gray-600 mb-6">
                    –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—Ä–µ–º—è –Ω–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å.
                    –¢–µ—Å—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à—ë–Ω —á–µ—Ä–µ–∑ <span id="autoSubmitCounter">3</span> —Å–µ–∫—É–Ω–¥.
                </p>

                <button type="button" onclick="submitTimeout()"
                    class="w-full px-5 py-3 rounded-full text-sm font-semibold bg-primary text-white transition hover:bg-emerald-700">
                    –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    let timeRemaining = parseInt(document.getElementById('timer').dataset.time);
    let timerInterval;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', () => {
        startTimer();
        preventAccidentalExit();
        autofocusFirstInput();
    });

    // –¢–∞–π–º–µ—Ä
    function startTimer() {
        updateTimerDisplay();

        timerInterval = setInterval(() => {
            timeRemaining--;
            updateTimerDisplay();

            // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 5 –º–∏–Ω—É—Ç
            if (timeRemaining === 300) {
                showTimeWarning('low');
            }

            // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 1 –º–∏–Ω—É—Ç—É
            if (timeRemaining === 60) {
                showTimeWarning('critical');
            }

            // –í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ
            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                handleTimeout();
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        const timerEl = document.getElementById('timer');
        timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –º–∞–ª–æ–º –≤—Ä–µ–º–µ–Ω–∏
        if (timeRemaining <= 60) {
            timerEl.classList.add('text-red-600');
            timerEl.classList.remove('text-gray-900', 'text-amber-600');
        } else if (timeRemaining <= 300) {
            timerEl.classList.add('text-amber-600');
            timerEl.classList.remove('text-gray-900', 'text-red-600');
        }
    }

    function showTimeWarning(type) {
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏–ª–∏ –∑–≤—É–∫
        console.log(`Time warning: ${type}`);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞
    function handleTimeout() {
        document.getElementById('timeoutModal').classList.remove('hidden');

        let countdown = 3;
        const counterEl = document.getElementById('autoSubmitCounter');

        const countdownInterval = setInterval(() => {
            countdown--;
            counterEl.textContent = countdown;

            if (countdown <= 0) {
                clearInterval(countdownInterval);
                submitTimeout();
            }
        }, 1000);
    }

    function submitTimeout() {
        const form = document.getElementById('testForm');
        const timeoutInput = document.createElement('input');
        timeoutInput.type = 'hidden';
        timeoutInput.name = 'timeout';
        timeoutInput.value = 'true';
        form.appendChild(timeoutInput);

        showLoadingScreen();
        form.submit();
    }

    // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    function confirmFinish() {
        document.getElementById('finishModal').classList.remove('hidden');
    }

    function closeFinishModal() {
        document.getElementById('finishModal').classList.add('hidden');
    }

    function finishTest() {
        const form = document.getElementById('testForm');

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        const finishInput = document.createElement('input');
        finishInput.type = 'hidden';
        finishInput.name = 'action';
        finishInput.value = 'finish';
        form.appendChild(finishInput);

        showLoadingScreen();
        form.submit();
    }

    // Loading screen
    function showLoadingScreen() {
        document.getElementById('loadingOverlay').classList.remove('hidden');
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('testForm').addEventListener('submit', (e) => {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ—Ç–≤–µ—Ç –≤—ã–±—Ä–∞–Ω
        const questionType = '{{ question.question_type }}';

        if (questionType === 'single') {
            const selected = document.querySelector('input[name="answer"]:checked');
            if (!selected) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç');
                return;
            }
        } else if (questionType === 'multiple') {
            const selected = document.querySelectorAll('input[name="answer"]:checked');
            if (selected.length === 0) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç');
                return;
            }
        } else if (questionType === 'text') {
            const textInput = document.getElementById('textAnswer');
            if (!textInput.value.trim()) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç');
                return;
            }
        }

        showLoadingScreen();
    });

    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
    function preventAccidentalExit() {
        window.addEventListener('beforeunload', (e) => {
            e.preventDefault();
            e.returnValue = '–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?';
        });
    }

    // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–º input
    function autofocusFirstInput() {
        const firstInput = document.querySelector('input[type="radio"], input[type="checkbox"], input[type="text"]');
        if (firstInput) {
            firstInput.focus();
        }
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ –ø–æ Esc
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeFinishModal();
        }
    });
</script>

<style>
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(8px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}